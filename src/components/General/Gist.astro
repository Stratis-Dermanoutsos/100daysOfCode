---
type Props = {
    gistCode: string;
    fileName: string;
};

const { gistCode, fileName } = Astro.props as Props;

const gistUrl = `https://gist.github.com/Stratis-Dermanoutsos/${gistCode}.js?file=${fileName}`;
const rawUrl = `https://gist.githubusercontent.com/Stratis-Dermanoutsos/${gistCode}/raw/${fileName}`

let code: String;
await fetch(rawUrl)
    .then(res => res.text())
    .then(text => {
        code = text
    });

import { v4 as uuidv4 } from 'uuid';
const myId = `${fileName.replace(/\.\w+$/, '')}-${uuidv4()}`;
---

<div id={myId}>
    <script src={gistUrl} />
</div>
<script define:vars={{ myId, code }}>
    const thisComponent = document.getElementById(myId).lastElementChild;

    const button = document.createElement('button');
        button.innerHTML = '<svg fill="none" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 512 512">' +
                            '<path fill="#fff" fill-rule="evenodd" d="M224 0c-35.3 0-64 28.7-64 64V288c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64H224zM64 160c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H288c35.3 0 64-28.7 64-64V384H288v64H64V224h64V160H64z"/>' +
                            '</svg>';
        button.addEventListener('click', (e) => {
            navigator.clipboard.writeText(code);
        });

    thisComponent.appendChild(button);
</script>
